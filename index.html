<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>점심 랜덤 추첨</title>
  <style>
    :root {
      --bg-1: #f6fbff;
      --bg-2: #e4efff;
      --card: #ffffff;
      --primary: #1e5aa8;
      --primary-2: #164782;
      --text: #12243c;
      --muted: #5f738d;
      --line: #d8e3f2;
      --active: #dff0ff;
      --accent: #2f7adf;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Malgun Gothic", "Apple SD Gothic Neo", sans-serif;
      color: var(--text);
      background:
        radial-gradient(circle at 10% 10%, #ffe28d66 0%, transparent 35%),
        radial-gradient(circle at 90% 10%, #7af0ff66 0%, transparent 35%),
        radial-gradient(circle at 50% 90%, #ff8fd466 0%, transparent 38%),
        radial-gradient(circle at top right, #d7e8ff 0%, var(--bg-1) 45%, var(--bg-2) 100%);
      display: grid;
      place-items: center;
      padding: 18px;
      overflow: hidden;
      transition: filter 180ms ease;
    }

    .bg-orbs {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .fx-canvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 3;
    }

    .orb {
      position: absolute;
      width: 18vmin;
      aspect-ratio: 1;
      border-radius: 50%;
      opacity: 0.24;
      filter: blur(2px);
      animation: floatUp 13s linear infinite;
    }

    .orb:nth-child(1) { left: 6%; top: 70%; background: #ff6b9f; animation-delay: -2s; }
    .orb:nth-child(2) { left: 20%; top: 88%; background: #ff9f43; animation-duration: 10s; }
    .orb:nth-child(3) { left: 36%; top: 72%; background: #ffd93d; animation-delay: -5s; }
    .orb:nth-child(4) { left: 52%; top: 90%; background: #32ff7e; animation-duration: 11s; }
    .orb:nth-child(5) { left: 68%; top: 76%; background: #18dcff; animation-delay: -3s; }
    .orb:nth-child(6) { left: 84%; top: 92%; background: #7d5fff; animation-duration: 12s; }

    .card {
      position: relative;
      z-index: 1;
      width: min(560px, 98vw);
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 20px;
      box-shadow: 0 18px 44px rgba(28, 55, 95, 0.14);
      padding: 22px;
      transition: transform 200ms ease, box-shadow 200ms ease;
      overflow: hidden;
    }


    h1 {
      margin: 0 0 8px;
      text-align: center;
      font-size: clamp(1.5rem, 2.8vw, 2rem);
      letter-spacing: 0.02em;
    }

    p {
      margin: 0 0 14px;
      text-align: center;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .list {
      border: 1px solid var(--line);
      border-radius: 12px;
      overflow: auto;
      margin-bottom: 14px;
      background: #ffffffd8;
      backdrop-filter: blur(4px);
    }

    .item {
      padding: 11px 14px;
      border-bottom: 1px solid #edf2fa;
      background: #fff;
      transition: background-color 120ms ease, color 120ms ease, transform 120ms ease;
      font-size: 1rem;
    }

    .item:last-child { border-bottom: none; }

    .item.active {
      background: linear-gradient(90deg, color-mix(in srgb, var(--accent) 24%, #ffffff), color-mix(in srgb, var(--accent) 10%, #f4f8ff));
      font-weight: 700;
      color: #102440;
      transform: scale(1.02);
      box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--accent) 48%, #ffffff);
    }

    .result {
      text-align: center;
      font-size: clamp(1.05rem, 2.2vw, 1.28rem);
      font-weight: 800;
      color: var(--primary);
      margin: 12px 0 16px;
      min-height: 1.8em;
      letter-spacing: 0.01em;
    }

    .result.winner {
      animation: winnerPop 800ms cubic-bezier(.22,1.4,.44,1) both;
      color: #0d3f8f;
      text-shadow: 0 0 16px #71a7ff88;
    }

    .actions {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 11px 12px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform 120ms ease, filter 120ms ease, box-shadow 120ms ease;
    }

    button:active { transform: translateY(1px); }

    #pickButton {
      background: linear-gradient(180deg, #2f7adf, var(--primary));
      color: #fff;
    }

    #pickButton:disabled {
      opacity: 0.74;
      cursor: not-allowed;
      filter: grayscale(0.1);
    }

    #resetButton {
      background: #ecf2fb;
      color: var(--primary-2);
    }

    #gameButton {
      background: #fff2de;
      color: #8b4d00;
    }

    body.rolling {
      animation: rainbowWash 1.2s linear infinite;
      filter: saturate(1.2);
    }

    body.rolling .card {
      transform: scale(1.015);
      box-shadow: 0 24px 50px rgba(15, 62, 128, 0.24);
    }

    body.rolling #pickButton {
      box-shadow: 0 0 18px #62b2ffcc;
      animation: pulseBtn 420ms ease-in-out infinite;
    }

    body.rolling .list {
      box-shadow: 0 0 0 2px #8fc4ff66, 0 0 20px #8fc4ff44;
    }

    @keyframes floatUp {
      0% { transform: translateY(16vh) scale(0.9); opacity: 0.16; }
      50% { opacity: 0.3; }
      100% { transform: translateY(-122vh) scale(1.22); opacity: 0; }
    }

    @keyframes rainbowWash {
      0% { filter: hue-rotate(0deg) saturate(1.2); }
      100% { filter: hue-rotate(360deg) saturate(1.2); }
    }

    @keyframes pulseBtn {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-1px) scale(1.03); }
    }

    @keyframes winnerPop {
      0% { transform: scale(0.82); opacity: 0; }
      65% { transform: scale(1.16); opacity: 1; }
      100% { transform: scale(1); }
    }

    @media (max-width: 600px) {
      .card { padding: 18px; }
      .item { font-size: 0.94rem; }
      .result { font-size: 1.08rem; }
      .orb { width: 24vmin; }
      .actions { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="bg-orbs" aria-hidden="true">
    <span class="orb"></span>
    <span class="orb"></span>
    <span class="orb"></span>
    <span class="orb"></span>
    <span class="orb"></span>
    <span class="orb"></span>
  </div>
  <canvas id="fxCanvas" class="fx-canvas" aria-hidden="true"></canvas>

  <main class="card" role="application" aria-label="점심 랜덤 추첨기">
    <h1>오늘 뭐 먹지?</h1>
    <p>아래 항목 중 랜덤으로 하나를 선택합니다.</p>

    <section id="list" class="list" aria-live="polite"></section>

    <div id="result" class="result">추첨 버튼을 눌러주세요</div>

    <div class="actions">
      <button id="pickButton" type="button">추첨</button>
      <button id="resetButton" type="button">초기화</button>
      <button id="gameButton" type="button">같은 그림 찾기</button>
    </div>
  </main>

  <script>
    const options = [
      "zip",
      "arko",
      "이마트",
      "오봉집",
      "서브웨이",
      "김제",
      "국보성",
      "칼국수",
      "부대찌개",
      "팀장님 추천(뉴 플레이스)"
    ];

    const palette = [
      "#ff5f6d",
      "#ff9f43",
      "#ffd93d",
      "#5de37a",
      "#18dcff",
      "#6c5ce7",
      "#f368e0",
      "#54a0ff"
    ];

    const listEl = document.getElementById("list");
    const resultEl = document.getElementById("result");
    const pickButton = document.getElementById("pickButton");
    const resetButton = document.getElementById("resetButton");
    const gameButton = document.getElementById("gameButton");
    const fxCanvas = document.getElementById("fxCanvas");
    const fxCtx = fxCanvas.getContext("2d");

    let rolling = false;
    let timerId = null;
    let fxFrameId = null;
    let particles = [];

    function resizeFxCanvas() {
      const ratio = window.devicePixelRatio || 1;
      const width = window.innerWidth;
      const height = window.innerHeight;
      fxCanvas.width = Math.floor(width * ratio);
      fxCanvas.height = Math.floor(height * ratio);
      fxCanvas.style.width = `${width}px`;
      fxCanvas.style.height = `${height}px`;
      fxCtx.setTransform(ratio, 0, 0, ratio, 0, 0);
    }

    function createParticle(x, y, speed, angle, color) {
      return {
        x,
        y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed,
        life: 80 + Math.random() * 40,
        age: 0,
        size: 2 + Math.random() * 4,
        color,
        spin: (Math.random() - 0.5) * 0.35
      };
    }

    function burst(x, y, count = 80, power = 6.8) {
      for (let i = 0; i < count; i += 1) {
        const angle = (Math.PI * 2 * i) / count + (Math.random() - 0.5) * 0.2;
        const speed = power * (0.35 + Math.random() * 0.8);
        const color = palette[Math.floor(Math.random() * palette.length)];
        particles.push(createParticle(x, y, speed, angle, color));
      }
      if (!fxFrameId) {
        animateParticles();
      }
    }

    function animateParticles() {
      fxCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
      particles = particles.filter((p) => p.age < p.life);

      for (const p of particles) {
        p.age += 1;
        p.vy += 0.07;
        p.vx *= 0.993;
        p.vy *= 0.995;
        p.x += p.vx;
        p.y += p.vy;

        const alpha = Math.max(0, 1 - p.age / p.life);
        fxCtx.save();
        fxCtx.globalAlpha = alpha;
        fxCtx.translate(p.x, p.y);
        fxCtx.rotate((p.age * p.spin) / 3);
        fxCtx.fillStyle = p.color;
        fxCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size * 1.6);
        fxCtx.restore();
      }

      if (particles.length > 0) {
        fxFrameId = window.requestAnimationFrame(animateParticles);
      } else {
        fxFrameId = null;
      }
    }

    function launchFireworks() {
      const w = window.innerWidth;
      const h = window.innerHeight;
      burst(w * 0.25, h * 0.32, 70, 7.1);
      window.setTimeout(() => burst(w * 0.75, h * 0.34, 76, 7.3), 120);
      window.setTimeout(() => burst(w * 0.5, h * 0.24, 96, 7.8), 240);
      window.setTimeout(() => burst(w * (0.25 + Math.random() * 0.5), h * (0.2 + Math.random() * 0.25), 82, 7.0), 420);
    }

    function resetFireworks() {
      particles = [];
      if (fxFrameId) {
        window.cancelAnimationFrame(fxFrameId);
        fxFrameId = null;
      }
      fxCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
    }

    function renderList(activeIndex = -1) {
      listEl.innerHTML = "";
      options.forEach((name, idx) => {
        const row = document.createElement("div");
        row.className = "item" + (idx === activeIndex ? " active" : "");
        if (idx === activeIndex) {
          row.style.setProperty("--accent", palette[Math.floor(Math.random() * palette.length)]);
        }
        row.textContent = name;
        listEl.appendChild(row);
      });
    }

    function setRollingState(enabled) {
      document.body.classList.toggle("rolling", enabled);
    }

    function showWinnerText(text) {
      resultEl.classList.remove("winner");
      void resultEl.offsetWidth;
      resultEl.textContent = text;
      resultEl.classList.add("winner");
    }

    function startRoll() {
      if (rolling) return;

      rolling = true;
      pickButton.disabled = true;
      setRollingState(true);
      resultEl.classList.remove("winner");
      resultEl.textContent = "돌리는 중...";

      let step = 0;
      const maxStep = 34;

      function animate() {
        if (step < maxStep) {
          const idx = Math.floor(Math.random() * options.length);
          renderList(idx);

          step += 1;
          const interval = 36 + step * 7;
          timerId = window.setTimeout(animate, interval);
          return;
        }

        const winnerIndex = Math.floor(Math.random() * options.length);
        renderList(winnerIndex);
        showWinnerText(`오늘의 선택: ${options[winnerIndex]}`);
        launchFireworks();

        rolling = false;
        pickButton.disabled = false;
        setRollingState(false);
        timerId = null;
      }

      animate();
    }

    function reset() {
      if (timerId !== null) {
        window.clearTimeout(timerId);
        timerId = null;
      }

      rolling = false;
      pickButton.disabled = false;
      setRollingState(false);
      resultEl.classList.remove("winner");
      renderList(-1);
      resultEl.textContent = "추첨 버튼을 눌러주세요";
      resetFireworks();
    }

    pickButton.addEventListener("click", startRoll);
    resetButton.addEventListener("click", reset);
    gameButton.addEventListener("click", () => {
      window.location.href = "/game";
    });
    window.addEventListener("resize", resizeFxCanvas);

    function init() {
      resizeFxCanvas();
      renderList();
    }

    init();
  </script>
</body>
</html>
